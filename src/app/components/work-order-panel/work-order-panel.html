<app-base-modal>
  <div class="panel panel--open">
    <div class="panel__header">
      <div>
        <h2 class="panel__title">Work Order Details</h2>
        <p class="panel__subtitle">Specify the dates, name and status for this order</p>
      </div>

      <div class="panel__actions">
        <button class="panel__btn panel__btn--ghost" (click)="onClose()">Cancel</button>
        <button
          class="panel__btn panel__btn--primary"
          (click)="onSubmit()"
          [disabled]="form.invalid"
        >
          {{ editingOrder ? 'Update' : 'Create' }}
        </button>
      </div>
    </div>

    <form class="panel__form" [formGroup]="form" (ngSubmit)="onSubmit()">
      <div class="panel__field">
        <label class="panel__label" for="woName">Work Order Name</label>

        <input
          id="woName"
          class="panel__input"
          [class.panel__input--error]="form.get('name')?.invalid && form.get('name')?.touched"
          formControlName="name"
          placeholder="Enter work order name"
        />

        @if (form.get('name')?.hasError('required') && form.get('name')?.touched) {
          <span class="panel__error">
            Name is required
          </span>
        }
      </div>

      <div class="panel__field">
        <label class="panel__label">Status</label>

        <ng-select
          formControlName="status"
          [items]="statusOptions"
          bindLabel="label"
          bindValue="value"
          placeholder="Select status"
          [clearable]="false"
          [searchable]="false"
        />

        @if (form.get('status')?.hasError('required') && form.get('status')?.touched) {
          <span class="panel__error">
            Status is required
          </span>
        }
      </div>

      <div class="panel__field">
        <label class="panel__label">Start Date</label>

        <div class="panel__date-wrapper">
          <input
            class="panel__input"
            [class.panel__input--error]="form.get('startDate')?.invalid && form.get('startDate')?.touched"
            placeholder="Select start date"
            ngbDatepicker
            #dpStart="ngbDatepicker"
            formControlName="startDate"
            (click)="dpStart.toggle()"
            readonly
          />
        </div>

        @if (form.get('startDate')?.hasError('required') && form.get('startDate')?.touched) {
          <span class="panel__error">
            Start date is required
          </span>
        }
      </div>

      <div class="panel__field">
        <label class="panel__label">End Date</label>

        <div class="panel__date-wrapper">
          <input
            class="panel__input"
            [class.panel__input--error]="form.get('endDate')?.invalid && form.get('endDate')?.touched"
            placeholder="Select end date"
            ngbDatepicker
            #dpEnd="ngbDatepicker"
            formControlName="endDate"
            (click)="dpEnd.toggle()"
            readonly
          />
        </div>

        @if (form.get('endDate')?.hasError('required') && form.get('endDate')?.touched) {
          <span class="panel__error">
            End date is required
          </span>
        }
      </div>

      @if (form.hasError('dateOrder')) {
        <div class="panel__error-box">
          End date must be after start date.
        </div>
      }
      @if (form.hasError('overlap')) {
        <div class="panel__error-box panel__error-box--overlap">
          This work order overlaps with an existing order on the same work center.
        </div>
      }
    </form>
  </div>
</app-base-modal>
